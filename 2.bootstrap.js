(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1:function(t,e,n){"use strict";n.r(e);var r=n(4),s=n(35);const a=n(13),i=n(40)();r.m();a.registerHelper("ifEquals",(function(t,e,n){return t===e?"function"!=typeof n.fn||n.fn(this):"function"==typeof n.inverse&&n.inverse(this)}));const o={allowedProtoProperties:{mark:!0,text:!0,code:!0,date:!0,location:!0,lot:!0}},l=a.compile("\n<tr class='patient'><td class='patient name cl-blue' colspan=3>{{name}}</td></tr>\n<tr><td class='patient-dob' colspan=3>{{dob}}</td></tr>\n{{#each vax}}\n    <tr class='detail_status'>\n        {{#ifEquals mark 'green'}}\n            <td class='vax-status cl-green' rowspan=2>&#x2713;</td>\n        {{/ifEquals}}\n        {{#ifEquals mark 'yellow'}}\n            <td class='vax-status cl-yellow' rowspan=2>&#x203c;</td>\n        {{/ifEquals}}\n        {{#ifEquals mark 'red'}}\n            <td class='vax-status cl-red' rowspan=2>&#x2718;</td>\n        {{/ifEquals}}\n        <td colspan='2' class='vax-name cl-yellow'>{{code}}</td>\n    </tr>\n    <tr class='detail_status'>\n        <td class='vax-lot' title='Lot: {{lot}}'>{{lot}}</td>\n        <td class='vax-location'>{{location}} ({{date}})</td>\n    </tr>\n{{/each}}\n{{#each status}}\n    <tr class='detail_status' id='vax-status-row'>\n        {{#ifEquals mark 'green'}}\n            <td class='vax-status cl-green'>&#x2713;</td>\n        {{/ifEquals}}\n        {{#ifEquals mark 'yellow'}}\n            <td class='vax-status cl-yellow'>&#x203c;</td>\n        {{/ifEquals}}\n        {{#ifEquals mark 'red'}}\n            <td class='vax-status cl-red'>&#x2718;</td>\n        {{/ifEquals}}\n        <td colspan=2>{{text}}</td>\n    </tr>\n{{/each}}\n{{#ifEquals vax_okay (ifEquals valid_sig (ifEquals is_cadph true)) }}\n    <tr class='smile_status active'><td class='cl-green' colspan=4>&#x263A;</td></tr>\n{{else}}\n    <tr class='smile_status active'><td class='cl-red' colspan=4>&#x2639;</td></tr>\n{{/ifEquals}}\n<tr class='smile_status active'><td colspan=4 style='font-size: 14pt'>Tap for details</td></tr>\n");class u{static file_changed(){let t,e,n,r;u.update_status("Loading…"),"function"==typeof window.FileReader?(t=document.getElementById("imgfile"),t?t.files?t.files[0]?(e=t.files[0],n=new FileReader,n.onload=function(){r=new Image,r.onload=u.image_loaded,r.src=n.result},n.readAsDataURL(e)):u.update_status("Please select a file before clicking 'Load'"):u.update_status("This browser doesn't seem to support the `files` property of file inputs."):u.update_status("Couldn't find the imgfile element.")):u.update_status("The file API isn't supported on this browser yet.")}static async image_loaded(t){let e=t.target;u.update_status("Scanning for QR codes");let n=r.a.new(),a=await u.resize_image(e);if(void 0!==n.parse(a))return void u.update_status("No Smart Health Card found: QR is not a valid Smart Health Card");let i=n.update();if(i)return void u.update_status(i);let d=n.imm_count();1===d?u.update_status("Found 1 record"):u.update_status(`Found ${d} records`);let c={name:n.patient_name(),dob:null,vax:[],status:[]};for(let t of n.vax_detail())c.vax.push(t);let f=n.vax_status();f&&c.status.push(f),c.is_cadph=n.issuer_is_calif_dph(),!1===c.is_cadph?(c.status.push({mark:"red",text:"Not issued by the California Department of Health"}),u.update_table(l(c,o)),u.update_status()):(u.update_status("Verifying signature"),fetch(`${n.issuer()}/.well-known/jwks.json`).then((t=>{if(!t.ok)throw Error(t.statusText);return t})).then((t=>t.json())).then((t=>{if(void 0===t.keys||!(t.keys.length>0))return c.status.push({mark:"red",text:"Unverified, public key could not be fetched"}),c;{let r,a=n.data(),i=n.kid(),o=a.split("."),l=o[0],u=o[1],d=o[2],f=!1,p=t.keys.reduce((function(t,e){return t[e.kid]=e,t}),{});if(void 0!==i&&(r=p[i],void 0!==r?f=!0:console.error("We don't have this key")),!1===f&&(console.error("Take the first key we've got"),r=t.keys[0],void 0===r))return c.status.push({mark:"red",text:"Unverified, public key could not be fetched"}),c;let h=new s.KJUR.crypto.Signature({alg:"SHA256withECDSA"});h.init(r),h.updateString(`${l}.${u}`);let y=s.KJUR.crypto.ECDSA.concatSigToASN1Sig(Object(s.b64utohex)(d));var e=h.verify(y);!1===e?(c.valid_sig=!1,c.status.push({mark:"red",text:"Not issued by the California Department of Health"})):!0===e&&!1===f?(c.valid_sig=!1,c.status.push({mark:"yellow",text:"Potentially issued by the California Department of Health, key thumbprint mismatch"})):!0===e&&!0===f&&(c.valid_sig=!0,c.status.push({mark:"green",text:"Issued by the California Department of Health"}))}return c})).then((t=>{u.update_table(l(t,o)),u.update_status()})).catch((t=>{c.status.push({mark:"red",text:"Unverified, public key could not be fetched"}),u.update_table(l(c,o)),u.update_status()})))}static toggle_row_on(t){let e=new Set(t.classList);e.add("active"),t.className=[...e].join(" ")}static toggle_row_off(t){let e=new Set(t.classList);e.delete("active"),t.className=[...e].join(" ")}static async resize_image(t){const e=document.getElementById("canvas"),n=e.getContext("2d"),r="image/png";e.width=t.width,e.height=t.height,n.drawImage(t,0,0,t.width,t.height,0,0,t.width,t.height);let s,a,o,l=!0;return t.width>=t.height?(s=800,a=s/t.width,o=Math.round(t.height*a),s>=t.width&&(l=!1)):(o=800,a=o/t.height,s=Math.round(t.width*a),o>=t.height&&(l=!1)),!0===l&&(e.height=o,e.width=s,await i.resize(t,e,{quality:3,unsharpAmount:0}).then((t=>console.log("resize done!",t)))),e.toDataURL(r).replace("data:image/png;base64,","")}static update_table(t){""==t?(document.getElementById("vax-body").innerHTML="",document.getElementById("vax").style.visibility="hidden"):(document.getElementById("vax-body").innerHTML=t,document.getElementById("vax").style.visibility="visible")}static update_status(t){let e=document.getElementById("status");void 0===t?(e.innerHTML="…",e.style.display="none"):(e.innerHTML=t,e.style.display="block")}}document.getElementById("vax-body").addEventListener("click",(function(t){const e=t.target.parentElement;e.classList.contains("smile_status")?(Array.prototype.map.call(document.getElementsByClassName("detail_status"),u.toggle_row_on),Array.prototype.map.call(document.getElementsByClassName("smile_status"),u.toggle_row_off)):e.classList.contains("detail_status")&&(Array.prototype.map.call(document.getElementsByClassName("detail_status"),u.toggle_row_off),Array.prototype.map.call(document.getElementsByClassName("smile_status"),u.toggle_row_on))})),document.getElementById("imgfile").onchange=function(){u.update_table(""),setTimeout(u.file_changed,100)}},4:function(t,e,n){"use strict";(function(t){n.d(e,"m",(function(){return v})),n.d(e,"a",(function(){return x})),n.d(e,"j",(function(){return k})),n.d(e,"k",(function(){return E})),n.d(e,"g",(function(){return q})),n.d(e,"i",(function(){return T})),n.d(e,"b",(function(){return A})),n.d(e,"f",(function(){return I})),n.d(e,"h",(function(){return C})),n.d(e,"c",(function(){return B})),n.d(e,"d",(function(){return L})),n.d(e,"e",(function(){return D})),n.d(e,"l",(function(){return H}));var r=n(42);const s=new Array(32).fill(void 0);function a(t){return s[t]}s.push(void 0,null,!0,!1);let i=s.length;function o(t){const e=a(t);return function(t){t<36||(s[t]=i,i=t)}(t),e}let l=new("undefined"==typeof TextDecoder?(0,t.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});l.decode();let u=null;function d(){return null!==u&&u.buffer===r.i.buffer||(u=new Uint8Array(r.i.buffer)),u}function c(t,e){return l.decode(d().subarray(t,t+e))}function f(t){i===s.length&&s.push(s.length+1);const e=i;return i=s[e],s[e]=t,e}let p=null;function h(){return null!==p&&p.buffer===r.i.buffer||(p=new Int32Array(r.i.buffer)),p}let y=0;let _=new("undefined"==typeof TextEncoder?(0,t.require)("util").TextEncoder:TextEncoder)("utf-8");const m="function"==typeof _.encodeInto?function(t,e){return _.encodeInto(t,e)}:function(t,e){const n=_.encode(t);return e.set(n),{read:t.length,written:n.length}};function g(t,e,n){if(void 0===n){const n=_.encode(t),r=e(n.length);return d().subarray(r,r+n.length).set(n),y=n.length,r}let r=t.length,s=e(r);const a=d();let i=0;for(;i<r;i++){const e=t.charCodeAt(i);if(e>127)break;a[s+i]=e}if(i!==r){0!==i&&(t=t.slice(i)),s=n(s,r,r=i+3*t.length);const e=d().subarray(s+i,s+r);i+=m(t,e).written}return y=i,s}function v(){r.h()}class w{static __wrap(t){const e=Object.create(w.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.a(t)}get mark(){try{const n=r.d(-16);r.j(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];return c(t,e)}finally{r.d(16),r.e(t,e)}}set mark(t){var e=g(t,r.f,r.g),n=y;r.k(this.ptr,e,n)}get text(){try{const n=r.d(-16);r.m(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];return c(t,e)}finally{r.d(16),r.e(t,e)}}set text(t){var e=g(t,r.f,r.g),n=y;r.l(this.ptr,e,n)}}class x{static __wrap(t){const e=Object.create(x.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.b(t)}static new(){var t=r.z();return x.__wrap(t)}parse(t){try{const i=r.d(-16);var e=g(t,r.f,r.g),n=y;r.A(i,this.ptr,e,n);var s=h()[i/4+0],a=h()[i/4+1];let o;return 0!==s&&(o=c(s,a).slice(),r.e(s,1*a)),o}finally{r.d(16)}}update(){try{const n=r.d(-16);r.C(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];let s;return 0!==t&&(s=c(t,e).slice(),r.e(t,1*e)),s}finally{r.d(16)}}data(){try{const n=r.d(-16);r.n(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];return c(t,e)}finally{r.d(16),r.e(t,e)}}issuer(){try{const n=r.d(-16);r.w(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];let s;return 0!==t&&(s=c(t,e).slice(),r.e(t,1*e)),s}finally{r.d(16)}}issuer_is_calif_dph(){return 0!==r.x(this.ptr)}kid(){try{const n=r.d(-16);r.y(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];let s;return 0!==t&&(s=c(t,e).slice(),r.e(t,1*e)),s}finally{r.d(16)}}patient_name(){try{const n=r.d(-16);r.B(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];let s;return 0!==t&&(s=c(t,e).slice(),r.e(t,1*e)),s}finally{r.d(16)}}imm_count(){return r.q(this.ptr)>>>0}imm_elapsed_time(){try{const n=r.d(-16);r.r(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];return 0===t?void 0:e}finally{r.d(16)}}imm_code(t){try{const s=r.d(-16);r.o(s,this.ptr,t);var e=h()[s/4+0],n=h()[s/4+1];return c(e,n)}finally{r.d(16),r.e(e,n)}}imm_occurrence(t){try{const s=r.d(-16);r.u(s,this.ptr,t);var e=h()[s/4+0],n=h()[s/4+1];return c(e,n)}finally{r.d(16),r.e(e,n)}}imm_provider(t){try{const s=r.d(-16);r.v(s,this.ptr,t);var e=h()[s/4+0],n=h()[s/4+1];return c(e,n)}finally{r.d(16),r.e(e,n)}}imm_lot(t){try{const s=r.d(-16);r.t(s,this.ptr,t);var e=h()[s/4+0],n=h()[s/4+1];return c(e,n)}finally{r.d(16),r.e(e,n)}}imm_completed(t){return 0!==r.p(this.ptr,t)}imm_is_two_dose(t){var e=r.s(this.ptr,t);return 16777215===e?void 0:0!==e}vax_detail(){return o(r.D(this.ptr))}vax_status(){var t=r.E(this.ptr);return 0===t?void 0:w.__wrap(t)}}class b{static __wrap(t){const e=Object.create(b.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.c(t)}get mark(){try{const n=r.d(-16);r.J(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];return c(t,e)}finally{r.d(16),r.e(t,e)}}set mark(t){var e=g(t,r.f,r.g),n=y;r.O(this.ptr,e,n)}get code(){try{const n=r.d(-16);r.F(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];return c(t,e)}finally{r.d(16),r.e(t,e)}}set code(t){var e=g(t,r.f,r.g),n=y;r.K(this.ptr,e,n)}get date(){try{const n=r.d(-16);r.G(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];return c(t,e)}finally{r.d(16),r.e(t,e)}}set date(t){var e=g(t,r.f,r.g),n=y;r.L(this.ptr,e,n)}get location(){try{const n=r.d(-16);r.H(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];return c(t,e)}finally{r.d(16),r.e(t,e)}}set location(t){var e=g(t,r.f,r.g),n=y;r.M(this.ptr,e,n)}get lot(){try{const n=r.d(-16);r.I(n,this.ptr);var t=h()[n/4+0],e=h()[n/4+1];return c(t,e)}finally{r.d(16),r.e(t,e)}}set lot(t){var e=g(t,r.f,r.g),n=y;r.N(this.ptr,e,n)}}function k(t){return f(b.__wrap(t))}function E(t){o(t)}function q(){return f(new Error)}function T(t,e){var n=g(a(e).stack,r.f,r.g),s=y;h()[t/4+1]=s,h()[t/4+0]=n}function A(t,e){try{console.error(c(t,e))}finally{r.e(t,e)}}function I(){return f(new Array)}function C(t,e){return a(t).push(a(e))}function B(t){return a(t).getTime()}function L(t){return a(t).getTimezoneOffset()}function D(){return f(new Date)}function H(t,e){throw new Error(c(t,e))}}).call(this,n(41)(t))},42:function(t,e,n){"use strict";var r=n.w[t.i];t.exports=r;n(4);r.P()}}]);